@model GroupVM

@section Scripts{
    <script src="~/js/logListener.js"></script>
}

<div style="flex-direction:row; display:flex; justify-content:space-between">
    <span class="page-header">@Model.Data.Name</span>
    <button class="btn cs_primary" data-toggle="modal" data-target="#" style="align-self:center">
        Users
    </button>
</div>

<input hidden id="userID" value="@Model.UserID" />

<hr />

<div id="dateContainer" style="display:flex; flex-direction:row; justify-content:center">
    <button class="btn cs_primary dateChange" data-datechange="-">
        <i class="fas fa-chevron-left"></i>
    </button>
    <div style="margin: 0 20px; display:flex; flex-direction:column">
        <span id="dateText" style="align-self:center; font-size:1.5rem">@DateTime.Today.ToShortDateString()</span>
        <span id="dayText" style="align-self:center; font-size: 1rem">@DateTime.Today.DayOfWeek</span>
    </div>
    <button class="btn cs_primary dateChange" data-datechange="+">
        <i class="fas fa-chevron-right"></i>
    </button>
</div>

<div class="row">
    <div class="col-md-3">
        <br />
        <h4>Users</h4>
        @foreach (var u in Model.Users)
        {
            <span>@u.Value.FirstName @u.Value.LastName</span>
        }
    </div>
</div>

<h4>Logs</h4>
@* This user's log *@
<div class="row">
    <div class="col-md-3">
        <span>You (Insert this user's name)</span>
    </div>
    <div class="col-md-9">
        @using (Html.BeginForm("UpdateLog", "Log", FormMethod.Post, new { id = "UpdateLogForm", @class = "post-ajax" }))
        {
            var thisUserLog = Model.Logs.FirstOrDefault(x => x.Value.UserID == "u1");
            @if (thisUserLog.Value != null)
            {
                <div class="form-group">
                    <label for="yesterdayTA">Yesterday:</label>
                    <textarea id="yesterdayTA" name="Yesterday" class="form-control check-value" rows="3" data-revert="@thisUserLog.Value.Yesterday">@thisUserLog.Value.Yesterday</textarea>
                </div>
                <div class="form-group">
                    <label for="todayTA">Today:</label>
                    <textarea id="todayTA" name="Today" class="form-control check-value" rows="3" data-revert="@thisUserLog.Value.Today">@thisUserLog.Value.Today</textarea>
                </div>
                <div class="form-group">
                    <label for="blockersTA">Blockers:</label>
                    <textarea id="blockersTA" name="Blockers" class="form-control check-value" rows="3" data-revert="@thisUserLog.Value.Blockers">@thisUserLog.Value.Blockers</textarea>
                </div>
                <input hidden name="DocId" value="@thisUserLog.Value.DocId" />
                <input hidden name="Date" value="@thisUserLog.Value.Date" />
                <input hidden name="GroupID" value="@thisUserLog.Value.GroupID" />
                <input hidden name="UserID" value="@thisUserLog.Value.UserID" />
                <input hidden name="UserName" value="@thisUserLog.Value.UserName" />
            }
            else
            {
                <div class="form-group">
                    <label for="yesterdayTA">Yesterday:</label>
                    <textarea id="yesterdayTA" name="Yesterday" class="form-control check-value" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="todayTA">Today:</label>
                    <textarea id="todayTA" name="Today" class="form-control check-value" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="blockersTA">Blockers:</label>
                    <textarea id="blockersTA" name="Blockers" class="form-control check-value" rows="3"></textarea>
                </div>
                <input hidden name="FormDate" value="@DateTime.Now.Date" />
                <input hidden name="GroupID" value="@Model.DocId" />
            }

            <div style="float:right">
                <button type="reset" class="btn cs_primary">Cancel</button>
                <button type="submit" class="btn cs_primary">Update</button>
            </div>
        }
    </div>
</div>

@* Template for new logs *@
<div class="row" id="log-copy-row" hidden>
    <div class="col-md-3">
        <span class="log-username">Name</span>
    </div>
    <div class="col-md-9">
        <span>Yesterday: </span>
        <span class="log-yesterday">Yesterday</span>
        <br />
        <span>Today: </span>
        <span class="log-today">Today</span>
        <br />
        <span>Blockers: </span>
        <span class="log-blockers">Blockers</span>
    </div>
</div>

@* Other users' logs *@
<div id="logs-container">
    @foreach (var log in Model.Logs)
    {
        <div class="row">
            <div class="col-md-3">
                <span>@log.Value.UserName</span>
            </div>
            <div class="col-md-9">
                <span>Yesterday: @log.Value.Yesterday</span>
                <br />
                <span>Today: @log.Value.Today</span>
                <br />
                <span>Blockers: @log.Value.Blockers</span>
            </div>
        </div>
    }
</div>